<!DOCTYPE html>
<html lang="en"><head>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-597958c53c93a607afca12fd375c57ed.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.8.26">

  <title>JSC 370: Data Science II</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #24292e;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #24292e; } /* Normal */
    code span.al { color: #ff5555; font-weight: bold; } /* Alert */
    code span.an { color: #6a737d; } /* Annotation */
    code span.at { color: #d73a49; } /* Attribute */
    code span.bn { color: #005cc5; } /* BaseN */
    code span.bu { color: #d73a49; } /* BuiltIn */
    code span.cf { color: #d73a49; } /* ControlFlow */
    code span.ch { color: #032f62; } /* Char */
    code span.cn { color: #005cc5; } /* Constant */
    code span.co { color: #6a737d; } /* Comment */
    code span.cv { color: #6a737d; } /* CommentVar */
    code span.do { color: #6a737d; } /* Documentation */
    code span.dt { color: #d73a49; } /* DataType */
    code span.dv { color: #005cc5; } /* DecVal */
    code span.er { color: #ff5555; text-decoration: underline; } /* Error */
    code span.ex { color: #d73a49; font-weight: bold; } /* Extension */
    code span.fl { color: #005cc5; } /* Float */
    code span.fu { color: #6f42c1; } /* Function */
    code span.im { color: #032f62; } /* Import */
    code span.in { color: #6a737d; } /* Information */
    code span.kw { color: #d73a49; } /* Keyword */
    code span.op { color: #24292e; } /* Operator */
    code span.ot { color: #6f42c1; } /* Other */
    code span.pp { color: #d73a49; } /* Preprocessor */
    code span.re { color: #6a737d; } /* RegionMarker */
    code span.sc { color: #005cc5; } /* SpecialChar */
    code span.ss { color: #032f62; } /* SpecialString */
    code span.st { color: #032f62; } /* String */
    code span.va { color: #e36209; } /* Variable */
    code span.vs { color: #032f62; } /* VerbatimString */
    code span.wa { color: #ff5555; } /* Warning */
  </style>
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/theme/quarto-5f66212b01f094180b8d10b5b9960144.css">
  <link rel="stylesheet" href="styles.css">
  <link href="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>
  
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">JSC 370: Data Science II</h1>
  <p class="subtitle">Week 5: Scraping and APIs</p>

<div class="quarto-title-authors">
</div>

</section>
<section id="what-is-a-web-api" class="slide level2">
<h2>What is a Web API?</h2>
<blockquote>
<p>A Web API is an application programming interface for either a web server or a web browser. – <a href="https://en.wikipedia.org/wiki/Web_API">Wikipedia</a></p>
</blockquote>
<p><strong>Examples:</strong></p>
<ul>
<li><a href="https://developer.themoviedb.org/docs/getting-started">The Movie Database API</a></li>
<li><a href="https://www.ncdc.noaa.gov/cdo-web/webservices/v2">NOAA Climate Data API</a></li>
<li><a href="https://developer.x.com/en">X API</a></li>
<li><a href="https://platform.openai.com/docs/api-reference">OpenAI API</a></li>
<li><a href="https://docs.github.com/en/rest">GitHub API</a></li>
<li><a href="http://api.geneontology.org/api">Gene Ontology API</a></li>
<li><a href="https://opentdb.com/api_config.php">Open Trivia API</a></li>
</ul>
</section>
<section id="how-do-apis-work" class="slide level2">
<h2>How do APIs work?</h2>
<p><strong>HTTP Methods:</strong></p>
<ul>
<li><strong>GET</strong>: Request data from a server</li>
<li><strong>POST</strong>: Send data to a server</li>
<li><strong>PUT</strong>: Update existing data</li>
<li><strong>DELETE</strong>: Remove data</li>
</ul>
<p>We’ll use the <code>requests</code> library in Python to interact with APIs.</p>
<div id="47a03335" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a></a><span class="im">import</span> requests</span>
<span id="cb1-2"><a></a>response <span class="op">=</span> requests.get(<span class="st">"https://api.example.com/data"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="additional-setup-for-apis" class="slide level2">
<h2>Additional setup for APIs</h2>
<p>In addition to <code>requests</code> we also need <code>pandas</code> (for all data science stuff!) and <code>json</code></p>
<div id="setup" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a></a><span class="im">import</span> requests</span>
<span id="cb2-2"><a></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-3"><a></a><span class="im">import</span> json</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="structure-of-a-url" class="slide level2">
<h2>Structure of a URL</h2>

<img data-src="https://cdn.tutsplus.com/net/authors/jeremymcpeak/http1-url-structure.png" width="700" class="r-stretch quarto-figure-center"><p class="caption">URL Structure</p><p>Source: <a href="https://code.tutsplus.com/tutorials/http-the-protocol-every-web-developer-must-know-part-1--net-31177">HTTP: The Protocol Every Web Developer Must Know</a></p>
</section>
<section id="structure-of-an-api-url" class="slide level2">
<h2>Structure of an API URL</h2>
<pre><code>https://api.themoviedb.org/3/discover/movie?api_key=abc123&amp;sort_by=revenue.desc&amp;page=1
\_____/\__________________/\_____________/\__________________________________________/
   |            |                 |                            |
Protocol    Base URL         Endpoint               Query Parameters
                              (Path)                  (key=value pairs)</code></pre>
<p><strong>Components:</strong></p>
<table class="caption-top">
<colgroup>
<col style="width: 25%">
<col style="width: 37%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th>Part</th>
<th>Example</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Protocol</strong></td>
<td><code>https://</code></td>
<td>Secure connection</td>
</tr>
<tr class="even">
<td><strong>Base URL</strong></td>
<td><code>api.themoviedb.org/3</code></td>
<td>API server + version</td>
</tr>
<tr class="odd">
<td><strong>Endpoint</strong></td>
<td><code>/discover/movie</code></td>
<td>Which resource to access</td>
</tr>
<tr class="even">
<td><strong>Query Params</strong></td>
<td><code>?api_key=...&amp;sort_by=...</code></td>
<td>Filter/customize results</td>
</tr>
</tbody>
</table>
</section>
<section id="what-is-json" class="slide level2">
<h2>What is JSON?</h2>
<p><strong>JSON</strong> (JavaScript Object Notation) is the standard format for API responses.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb4-1"><a></a><span class="fu">{</span></span>
<span id="cb4-2"><a></a>  <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"Avatar"</span><span class="fu">,</span></span>
<span id="cb4-3"><a></a>  <span class="dt">"year"</span><span class="fu">:</span> <span class="dv">2009</span><span class="fu">,</span></span>
<span id="cb4-4"><a></a>  <span class="dt">"budget"</span><span class="fu">:</span> <span class="dv">237000000</span><span class="fu">,</span></span>
<span id="cb4-5"><a></a>  <span class="dt">"genres"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"Action"</span><span class="ot">,</span> <span class="st">"Adventure"</span><span class="ot">,</span> <span class="st">"Sci-Fi"</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb4-6"><a></a>  <span class="dt">"awards"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-7"><a></a>    <span class="dt">"oscars"</span><span class="fu">:</span> <span class="dv">3</span><span class="fu">,</span></span>
<span id="cb4-8"><a></a>    <span class="dt">"nominations"</span><span class="fu">:</span> <span class="dv">9</span></span>
<span id="cb4-9"><a></a>  <span class="fu">}</span></span>
<span id="cb4-10"><a></a><span class="fu">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Key features:</strong></p>
<ul>
<li><strong>Objects</strong>: <code>{ }</code> contain key-value pairs</li>
<li><strong>Arrays</strong>: <code>[ ]</code> contain ordered lists</li>
<li><strong>Values</strong>: strings, numbers, booleans, null, objects, or arrays</li>
<li>Human-readable and easy to parse in Python with <code>.json()</code></li>
</ul>
</section>
<section id="web-apis-with-curl" class="slide level2">
<h2>Web APIs with curl</h2>
<p>Under-the-hood, the <code>requests</code> library sends HTTP requests similar to curl:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a></a><span class="ex">curl</span> <span class="at">-X</span> GET <span class="st">"https://api.github.com/users/octocat"</span> <span class="dt">\</span></span>
<span id="cb5-2"><a></a>     <span class="at">-H</span> <span class="st">"Accept: application/json"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Response (JSON):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb6-1"><a></a><span class="fu">{</span></span>
<span id="cb6-2"><a></a>  <span class="dt">"login"</span><span class="fu">:</span> <span class="st">"octocat"</span><span class="fu">,</span></span>
<span id="cb6-3"><a></a>  <span class="dt">"id"</span><span class="fu">:</span> <span class="dv">583231</span><span class="fu">,</span></span>
<span id="cb6-4"><a></a>  <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"User"</span><span class="fu">,</span></span>
<span id="cb6-5"><a></a>  <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"The Octocat"</span><span class="fu">,</span></span>
<span id="cb6-6"><a></a>  <span class="dt">"company"</span><span class="fu">:</span> <span class="st">"@github"</span><span class="fu">,</span></span>
<span id="cb6-7"><a></a>  <span class="dt">"location"</span><span class="fu">:</span> <span class="st">"San Francisco"</span><span class="fu">,</span></span>
<span id="cb6-8"><a></a>  <span class="dt">"public_repos"</span><span class="fu">:</span> <span class="dv">8</span><span class="fu">,</span></span>
<span id="cb6-9"><a></a>  <span class="dt">"followers"</span><span class="fu">:</span> <span class="dv">16000</span></span>
<span id="cb6-10"><a></a><span class="fu">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The <code>-X GET</code> specifies the HTTP method, <code>-H</code> adds headers.</p>
</section>
<section id="http-status-codes" class="slide level2">
<h2>HTTP Status Codes</h2>

<img data-src="img/api-diagram.svg" class="quarto-figure quarto-figure-center r-stretch" style="width:200.0%"><p>Remember these HTTP codes:</p>
<ul>
<li><strong>1xx</strong>: Information message</li>
<li><strong>2xx</strong>: Success (200 = OK)</li>
<li><strong>3xx</strong>: Redirection (301 = Moved Permanently)</li>
<li><strong>4xx</strong>: Client error (404 = Not Found)</li>
<li><strong>5xx</strong>: Server error (500 = Internal Server Error)</li>
</ul>
</section>
<section id="api-keys-and-tokens" class="slide level2">
<h2>API Keys and Tokens</h2>
<p>Sometimes APIs require authentication:</p>
<ul>
<li><strong>API Key/Token</strong>: Passed in header or URL</li>
<li><strong>OAuth</strong>: More complex authentication flow</li>
<li><strong>Basic Auth</strong>: Username/password</li>
</ul>
<p>Example 1: <a href="https://developer.themoviedb.org/docs/getting-started">The Movie Database API</a> to discover popular movies and their details.</p>
<p>Get your free API key at: <a href="https://www.themoviedb.org/settings/api">themoviedb.org</a></p>
<p>Example 2: <a href="https://www.ncdc.noaa.gov/cdo-web/webservices/v2">NOAA Climate Data API</a> (data we used in earlier weeks)</p>
<p>Get your token at: <a href="https://www.ncdc.noaa.gov/cdo-web/token">https://www.ncdc.noaa.gov/cdo-web/token</a></p>
</section>
<section id="web-api-example-1-the-movie-database-tmdb" class="slide level2">
<h2>Web API Example 1: The Movie Database (TMDB)</h2>
<p>Using TMDB</p>
<div id="tmdb-setup" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a></a><span class="co"># TMDB API configuration</span></span>
<span id="cb7-2"><a></a>BASE_URL <span class="op">=</span> <span class="st">"https://api.themoviedb.org/3"</span></span>
<span id="cb7-3"><a></a>API_KEY <span class="op">=</span> <span class="st">"demo"</span>  <span class="co"># Replace with your API key!</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="tmdb-api-discovering-movies" class="slide level2">
<h2>TMDB API: Discovering Movies</h2>
<div id="tmdb-discover" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a></a><span class="co"># Discover top-grossing movies from 2020-2024</span></span>
<span id="cb8-2"><a></a>url <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>BASE_URL<span class="sc">}</span><span class="ss">/discover/movie"</span></span>
<span id="cb8-3"><a></a></span>
<span id="cb8-4"><a></a>params <span class="op">=</span> {</span>
<span id="cb8-5"><a></a>    <span class="st">"api_key"</span>: API_KEY,</span>
<span id="cb8-6"><a></a>    <span class="st">"sort_by"</span>: <span class="st">"revenue.desc"</span>,</span>
<span id="cb8-7"><a></a>    <span class="st">"release_date.gte"</span>: <span class="st">"2020-01-01"</span>,</span>
<span id="cb8-8"><a></a>    <span class="st">"release_date.lte"</span>: <span class="st">"2024-12-31"</span>,</span>
<span id="cb8-9"><a></a>    <span class="st">"page"</span>: <span class="dv">1</span></span>
<span id="cb8-10"><a></a>}</span>
<span id="cb8-11"><a></a></span>
<span id="cb8-12"><a></a>response <span class="op">=</span> requests.get(url, params<span class="op">=</span>params, timeout<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb8-13"><a></a><span class="bu">print</span>(<span class="ss">f"Status Code: </span><span class="sc">{</span>response<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-14"><a></a><span class="bu">print</span>(<span class="ss">f"URL: </span><span class="sc">{</span>response<span class="sc">.</span>url<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Status Code: 200
URL: https://api.themoviedb.org/3/discover/movie?api_key=f6600b8ecd0876798ce46888f63faf47&amp;sort_by=revenue.desc&amp;release_date.gte=2020-01-01&amp;release_date.lte=2024-12-31&amp;page=1</code></pre>
</div>
</div>
</section>
<section id="tmdb-api-understanding-query-parameters" class="slide level2">
<h2>TMDB API: Understanding Query Parameters</h2>
<p>Each parameter customizes what movies we get back:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a></a>params <span class="op">=</span> {</span>
<span id="cb10-2"><a></a>    <span class="st">"api_key"</span>: API_KEY,           <span class="co"># Authentication (required)</span></span>
<span id="cb10-3"><a></a>    <span class="st">"sort_by"</span>: <span class="st">"revenue.desc"</span>,    <span class="co"># Sort by revenue, descending</span></span>
<span id="cb10-4"><a></a>    <span class="st">"release_date.gte"</span>: <span class="st">"2020-01-01"</span>,  <span class="co"># Released on or after</span></span>
<span id="cb10-5"><a></a>    <span class="st">"release_date.lte"</span>: <span class="st">"2024-12-31"</span>,  <span class="co"># Released on or before</span></span>
<span id="cb10-6"><a></a>    <span class="st">"page"</span>: <span class="dv">1</span>                     <span class="co"># Which page of results</span></span>
<span id="cb10-7"><a></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<table class="caption-top">
<thead>
<tr class="header">
<th>Parameter</th>
<th>Value</th>
<th>Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>sort_by</code></td>
<td><code>revenue.desc</code></td>
<td>Highest-grossing first</td>
</tr>
<tr class="even">
<td><code>release_date.gte</code></td>
<td><code>2020-01-01</code></td>
<td>Only movies from 2020+</td>
</tr>
<tr class="odd">
<td><code>release_date.lte</code></td>
<td><code>2024-12-31</code></td>
<td>Only movies up to 2024</td>
</tr>
<tr class="even">
<td><code>page</code></td>
<td><code>1</code></td>
<td>First 20 results</td>
</tr>
</tbody>
</table>
</section>
<section id="how-do-we-know-what-parameters-are-available" class="slide level2">
<h2>How Do We Know What Parameters Are Available?</h2>
<p><strong>Read the API documentation!</strong> Every API publishes docs explaining:</p>
<ul>
<li>Available <strong>endpoints</strong> (URLs)</li>
<li>Required vs optional <strong>parameters</strong></li>
<li><strong>Authentication</strong> method</li>
<li><strong>Response format</strong> and fields</li>
</ul>
<p><a href="https://developer.themoviedb.org/reference/discover-movie">TMDB Discover Movies API Docs</a></p>
</section>
<section id="how-do-we-know-what-parameters-are-available-1" class="slide level2">
<h2>How Do We Know What Parameters Are Available?</h2>

<img data-src="img/tmdb-docs.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="tmdb-api-understanding-the-response" class="slide level2">
<h2>TMDB API: Understanding the Response</h2>
<p><code>response.json</code> parses the HTTP response body as JSON and return it as normal Python objects (usually a dict or list)</p>
<div id="tmdb-response" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a></a>data <span class="op">=</span> response.json()</span>
<span id="cb11-2"><a></a></span>
<span id="cb11-3"><a></a><span class="co"># The response contains pagination info and results</span></span>
<span id="cb11-4"><a></a><span class="bu">print</span>(<span class="ss">f"Total results: </span><span class="sc">{</span>data<span class="sc">.</span>get(<span class="st">'total_results'</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-5"><a></a><span class="bu">print</span>(<span class="ss">f"Total pages: </span><span class="sc">{</span>data<span class="sc">.</span>get(<span class="st">'total_pages'</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-6"><a></a><span class="bu">print</span>(<span class="ss">f"Movies on this page: </span><span class="sc">{</span><span class="bu">len</span>(data.get(<span class="st">'results'</span>, []))<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Total results: 240380
Total pages: 12019
Movies on this page: 20</code></pre>
</div>
</div>
</section>
<section id="tmdb-api-extracting-movie-data" class="slide level2">
<h2>TMDB API: Extracting Movie Data</h2>
<div id="cell-tmdb-extract" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a></a><span class="co"># Extract movie information from results this turns into a list</span></span>
<span id="cb13-2"><a></a>movies <span class="op">=</span> []</span>
<span id="cb13-3"><a></a><span class="cf">for</span> movie <span class="kw">in</span> data.get(<span class="st">'results'</span>, []):</span>
<span id="cb13-4"><a></a>    movies.append({</span>
<span id="cb13-5"><a></a>        <span class="st">'movie_id'</span>: movie.get(<span class="st">'id'</span>),</span>
<span id="cb13-6"><a></a>        <span class="st">'title'</span>: movie.get(<span class="st">'title'</span>),</span>
<span id="cb13-7"><a></a>        <span class="st">'release_date'</span>: movie.get(<span class="st">'release_date'</span>),</span>
<span id="cb13-8"><a></a>        <span class="st">'popularity'</span>: movie.get(<span class="st">'popularity'</span>),</span>
<span id="cb13-9"><a></a>        <span class="st">'vote_average'</span>: movie.get(<span class="st">'vote_average'</span>)</span>
<span id="cb13-10"><a></a>    })</span>
<span id="cb13-11"><a></a></span>
<span id="cb13-12"><a></a><span class="co"># Convert to DataFrame</span></span>
<span id="cb13-13"><a></a>df_movies <span class="op">=</span> pd.DataFrame(movies)</span>
<span id="cb13-14"><a></a><span class="bu">print</span>(<span class="ss">f"Found </span><span class="sc">{</span><span class="bu">len</span>(df_movies)<span class="sc">}</span><span class="ss"> movies"</span>)</span>
<span id="cb13-15"><a></a>df_movies.head(<span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Found 20 movies</code></pre>
</div>
<div id="tmdb-extract" class="cell-output cell-output-display" data-execution_count="6">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">movie_id</th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">release_date</th>
<th data-quarto-table-cell-role="th">popularity</th>
<th data-quarto-table-cell-role="th">vote_average</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>19995</td>
<td>Avatar</td>
<td>2009-12-16</td>
<td>43.7770</td>
<td>7.600</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>299534</td>
<td>Avengers: Endgame</td>
<td>2019-04-24</td>
<td>17.3797</td>
<td>8.236</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>76600</td>
<td>Avatar: The Way of Water</td>
<td>2022-12-14</td>
<td>41.0016</td>
<td>7.600</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>597</td>
<td>Titanic</td>
<td>1997-12-18</td>
<td>30.2952</td>
<td>7.902</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>140607</td>
<td>Star Wars: The Force Awakens</td>
<td>2015-12-15</td>
<td>9.9024</td>
<td>7.252</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>299536</td>
<td>Avengers: Infinity War</td>
<td>2018-04-25</td>
<td>28.5981</td>
<td>8.234</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>634649</td>
<td>Spider-Man: No Way Home</td>
<td>2021-12-15</td>
<td>25.5223</td>
<td>7.934</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>1022789</td>
<td>Inside Out 2</td>
<td>2024-06-11</td>
<td>21.0638</td>
<td>7.546</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>420818</td>
<td>The Lion King</td>
<td>2019-07-12</td>
<td>9.3301</td>
<td>7.097</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>24428</td>
<td>The Avengers</td>
<td>2012-04-25</td>
<td>67.3150</td>
<td>7.928</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="tmdb-api-getting-movie-details" class="slide level2">
<h2>TMDB API: Getting Movie Details</h2>
<p>Each movie has additional details available that we can extract.</p>
<p>Here we extract one movie and see several attributes:</p>
<div id="tmdb-details" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a></a><span class="co"># Get details for a specific movie (e.g., movie_id = 550 is Fight Club)</span></span>
<span id="cb15-2"><a></a>movie_id <span class="op">=</span> <span class="dv">550</span></span>
<span id="cb15-3"><a></a>detail_url <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>BASE_URL<span class="sc">}</span><span class="ss">/movie/</span><span class="sc">{</span>movie_id<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb15-4"><a></a></span>
<span id="cb15-5"><a></a>detail_response <span class="op">=</span> requests.get(detail_url, params<span class="op">=</span>{<span class="st">"api_key"</span>: API_KEY}, timeout<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb15-6"><a></a>movie_details <span class="op">=</span> detail_response.json()</span>
<span id="cb15-7"><a></a></span>
<span id="cb15-8"><a></a><span class="bu">print</span>(<span class="ss">f"Title: </span><span class="sc">{</span>movie_details<span class="sc">.</span>get(<span class="st">'title'</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-9"><a></a><span class="bu">print</span>(<span class="ss">f"Budget: $</span><span class="sc">{</span>movie_details<span class="sc">.</span>get(<span class="st">'budget'</span>)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb15-10"><a></a><span class="bu">print</span>(<span class="ss">f"Revenue: $</span><span class="sc">{</span>movie_details<span class="sc">.</span>get(<span class="st">'revenue'</span>)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb15-11"><a></a><span class="bu">print</span>(<span class="ss">f"Runtime: </span><span class="sc">{</span>movie_details<span class="sc">.</span>get(<span class="st">'runtime'</span>)<span class="sc">}</span><span class="ss"> minutes"</span>)</span>
<span id="cb15-12"><a></a><span class="bu">print</span>(<span class="ss">f"Genres: </span><span class="sc">{</span>[g[<span class="st">'name'</span>] <span class="cf">for</span> g <span class="kw">in</span> movie_details.get(<span class="st">'genres'</span>, [])]<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Title: Fight Club
Budget: $63,000,000
Revenue: $100,853,753
Runtime: 139 minutes
Genres: ['Drama', 'Thriller']</code></pre>
</div>
</div>
</section>
<section id="tmdb-api-fetching-multiple-pages" class="slide level2">
<h2>TMDB API: Fetching Multiple Pages</h2>
<p>The discover endpoint returns <strong>20 movies per page</strong>. To get more data, we loop through pages:</p>
<div id="tmdb-pagination" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a></a><span class="im">import</span> time</span>
<span id="cb17-2"><a></a></span>
<span id="cb17-3"><a></a><span class="co"># Fetch first 3 pages of results (60 movies)</span></span>
<span id="cb17-4"><a></a>all_movies <span class="op">=</span> []</span>
<span id="cb17-5"><a></a></span>
<span id="cb17-6"><a></a><span class="cf">for</span> page <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">4</span>):</span>
<span id="cb17-7"><a></a>    params <span class="op">=</span> {</span>
<span id="cb17-8"><a></a>        <span class="st">"api_key"</span>: API_KEY,</span>
<span id="cb17-9"><a></a>        <span class="st">"sort_by"</span>: <span class="st">"revenue.desc"</span>,</span>
<span id="cb17-10"><a></a>        <span class="st">"release_date.gte"</span>: <span class="st">"2020-01-01"</span>,</span>
<span id="cb17-11"><a></a>        <span class="st">"page"</span>: page</span>
<span id="cb17-12"><a></a>    }</span>
<span id="cb17-13"><a></a></span>
<span id="cb17-14"><a></a>    resp <span class="op">=</span> requests.get(<span class="ss">f"</span><span class="sc">{</span>BASE_URL<span class="sc">}</span><span class="ss">/discover/movie"</span>, params<span class="op">=</span>params, timeout<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb17-15"><a></a>    data <span class="op">=</span> resp.json()</span>
<span id="cb17-16"><a></a></span>
<span id="cb17-17"><a></a>    <span class="cf">for</span> movie <span class="kw">in</span> data.get(<span class="st">'results'</span>, []):</span>
<span id="cb17-18"><a></a>        all_movies.append({</span>
<span id="cb17-19"><a></a>            <span class="st">'id'</span>: movie.get(<span class="st">'id'</span>),</span>
<span id="cb17-20"><a></a>            <span class="st">'title'</span>: movie.get(<span class="st">'title'</span>),</span>
<span id="cb17-21"><a></a>            <span class="st">'popularity'</span>: movie.get(<span class="st">'popularity'</span>)</span>
<span id="cb17-22"><a></a>        })</span>
<span id="cb17-23"><a></a></span>
<span id="cb17-24"><a></a>    <span class="bu">print</span>(<span class="ss">f"Page </span><span class="sc">{</span>page<span class="sc">}</span><span class="ss">: fetched </span><span class="sc">{</span><span class="bu">len</span>(data.get(<span class="st">'results'</span>, []))<span class="sc">}</span><span class="ss"> movies"</span>)</span>
<span id="cb17-25"><a></a>    time.sleep(<span class="fl">0.25</span>)  <span class="co"># Be polite: wait 250ms between requests</span></span>
<span id="cb17-26"><a></a></span>
<span id="cb17-27"><a></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Total movies collected: </span><span class="sc">{</span><span class="bu">len</span>(all_movies)<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Page 1: fetched 20 movies
Page 2: fetched 20 movies
Page 3: fetched 20 movies

Total movies collected: 60</code></pre>
</div>
</div>
</section>
<section id="web-api-example-2-hhs-health-recommendations" class="slide level2">
<h2>Web API Example 2: HHS Health Recommendations</h2>
<p>The <a href="https://health.gov/our-work/health-literacy/consumer-health-content/free-web-content/apis-developers/documentation">Health.gov API</a> provides demographic-specific health recommendations. This API does not require a key or token</p>
<div id="hhs-api" class="cell" data-cache="true" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a></a>url <span class="op">=</span> <span class="st">"https://health.gov/myhealthfinder/api/v3/myhealthfinder.json"</span></span>
<span id="cb19-2"><a></a>params <span class="op">=</span> {</span>
<span id="cb19-3"><a></a>    <span class="st">"lang"</span>: <span class="st">"en"</span>,</span>
<span id="cb19-4"><a></a>    <span class="st">"age"</span>: <span class="st">"32"</span>,</span>
<span id="cb19-5"><a></a>    <span class="st">"sex"</span>: <span class="st">"male"</span>,</span>
<span id="cb19-6"><a></a>    <span class="st">"tobaccoUse"</span>: <span class="dv">0</span></span>
<span id="cb19-7"><a></a>}</span>
<span id="cb19-8"><a></a>headers <span class="op">=</span> {<span class="st">"accept"</span>: <span class="st">"application/json"</span>}</span>
<span id="cb19-9"><a></a></span>
<span id="cb19-10"><a></a>response <span class="op">=</span> requests.get(url, params<span class="op">=</span>params, headers<span class="op">=</span>headers, timeout<span class="op">=</span><span class="dv">60</span>)</span>
<span id="cb19-11"><a></a><span class="bu">print</span>(<span class="ss">f"Status Code: </span><span class="sc">{</span>response<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Status Code: 200</code></pre>
</div>
</div>
</section>
<section id="hhs-extracting-health-recommendations" class="slide level2">
<h2>HHS: Extracting Health Recommendations</h2>
<div id="hhs-extract" class="cell" data-cache="true" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a></a>data <span class="op">=</span> response.json()</span>
<span id="cb21-2"><a></a></span>
<span id="cb21-3"><a></a><span class="co"># Extract recommendation titles</span></span>
<span id="cb21-4"><a></a>titles <span class="op">=</span> []</span>
<span id="cb21-5"><a></a>resources <span class="op">=</span> data.get(<span class="st">'Result'</span>, {}).get(<span class="st">'Resources'</span>, {})</span>
<span id="cb21-6"><a></a></span>
<span id="cb21-7"><a></a><span class="cf">for</span> category <span class="kw">in</span> resources.values():</span>
<span id="cb21-8"><a></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(category, <span class="bu">dict</span>) <span class="kw">and</span> <span class="st">'Resource'</span> <span class="kw">in</span> category:</span>
<span id="cb21-9"><a></a>        <span class="cf">for</span> resource <span class="kw">in</span> category[<span class="st">'Resource'</span>]:</span>
<span id="cb21-10"><a></a>            titles.append(resource.get(<span class="st">'Title'</span>, <span class="st">'N/A'</span>))</span>
<span id="cb21-11"><a></a></span>
<span id="cb21-12"><a></a><span class="bu">print</span>(<span class="st">"Health Recommendations:"</span>)</span>
<span id="cb21-13"><a></a><span class="cf">for</span> title <span class="kw">in</span> titles[:<span class="dv">10</span>]:</span>
<span id="cb21-14"><a></a>    <span class="bu">print</span>(<span class="ss">f"  - </span><span class="sc">{</span>title<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Health Recommendations:
  - Quit Smoking
  - Hepatitis C Screening: Questions for the Doctor
  - Protect Yourself from Seasonal Flu
  - Talk with Your Doctor About Depression
  - Get Your Blood Pressure Checked
  - Get Tested for HIV
  - Get Vaccines to Protect Your Health (Adults Ages 19 to 49 Years)
  - Drink Alcohol Only in Moderation
  - Talk with Your Doctor About Drug Misuse and Substance Use Disorder
  - Aim for a Healthy Weight</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<h3 id="hhs-params">HHS: params</h3>
<p><img data-src="img/hhs-docs.png" class="quarto-figure quarto-figure-center" style="width:100.0%"> <a href="https://odphp.health.gov/our-work/national-health-initiatives/health-literacy/consumer-health-content/free-web-content/apis-developers/api-documentation">HHS</a></p>
</section>
<section id="why-use-a-dictionary-for-parameters" class="slide level2">
<h2>Why Use a Dictionary for Parameters?</h2>
<p><strong>Instead of this:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a></a>url <span class="op">=</span> <span class="st">"https://api.example.com/data?age=32&amp;sex=male&amp;lang=en"</span></span>
<span id="cb23-2"><a></a>response <span class="op">=</span> requests.get(url)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Do this:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a></a>url <span class="op">=</span> <span class="st">"https://api.example.com/data"</span></span>
<span id="cb24-2"><a></a>params <span class="op">=</span> {<span class="st">"age"</span>: <span class="dv">32</span>, <span class="st">"sex"</span>: <span class="st">"male"</span>, <span class="st">"lang"</span>: <span class="st">"en"</span>}</span>
<span id="cb24-3"><a></a>response <span class="op">=</span> requests.get(url, params<span class="op">=</span>params)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Benefits:</strong></p>
<ul>
<li>Automatic URL encoding (handles special characters)</li>
<li>Easier to read and modify</li>
<li>No manual string concatenation errors</li>
</ul>
</section>
<section id="common-parameter-patterns-in-apis" class="slide level2">
<h2>Common Parameter Patterns in APIs</h2>
<table class="caption-top">
<thead>
<tr class="header">
<th>Parameter Type</th>
<th>Example</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Filtering</strong></td>
<td><code>?status=active</code></td>
<td>Only return matching items</td>
</tr>
<tr class="even">
<td><strong>Pagination</strong></td>
<td><code>?page=2&amp;limit=50</code></td>
<td>Control result batches</td>
</tr>
<tr class="odd">
<td><strong>Sorting</strong></td>
<td><code>?sort=date&amp;order=desc</code></td>
<td>Order results</td>
</tr>
<tr class="even">
<td><strong>Fields</strong></td>
<td><code>?fields=name,email</code></td>
<td>Select specific data</td>
</tr>
<tr class="odd">
<td><strong>Search</strong></td>
<td><code>?q=python</code></td>
<td>Text search</td>
</tr>
<tr class="even">
<td><strong>Format</strong></td>
<td><code>?format=json</code></td>
<td>Response format</td>
</tr>
</tbody>
</table>
</section>
<section id="timeout-and-connection-options" class="slide level2">
<h2>Timeout and Connection Options</h2>
<p>Sometimes APIs are slow. Use the <code>timeout</code> parameter:</p>
<div id="timeout-example" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a></a><span class="co"># Set connection and read timeout (in seconds)</span></span>
<span id="cb25-2"><a></a>response <span class="op">=</span> requests.get(</span>
<span id="cb25-3"><a></a>    url,</span>
<span id="cb25-4"><a></a>    params<span class="op">=</span>params,</span>
<span id="cb25-5"><a></a>    timeout<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">60</span>)  <span class="co"># (connect timeout, read timeout)</span></span>
<span id="cb25-6"><a></a>)</span>
<span id="cb25-7"><a></a></span>
<span id="cb25-8"><a></a><span class="co"># Or single timeout for both</span></span>
<span id="cb25-9"><a></a>response <span class="op">=</span> requests.get(url, timeout<span class="op">=</span><span class="dv">60</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="rate-limiting" class="slide level2">
<h2>Rate Limiting</h2>
<p>Many APIs limit how many requests you can make. Use <code>time.sleep()</code> to be polite:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a></a><span class="im">import</span> time</span>
<span id="cb26-2"><a></a></span>
<span id="cb26-3"><a></a><span class="cf">for</span> movie_id <span class="kw">in</span> movie_ids:</span>
<span id="cb26-4"><a></a>    response <span class="op">=</span> requests.get(<span class="ss">f"</span><span class="sc">{</span>BASE_URL<span class="sc">}</span><span class="ss">/movie/</span><span class="sc">{</span>movie_id<span class="sc">}</span><span class="ss">"</span>, params<span class="op">=</span>params)</span>
<span id="cb26-5"><a></a>    data <span class="op">=</span> response.json()</span>
<span id="cb26-6"><a></a>    <span class="co"># Process data...</span></span>
<span id="cb26-7"><a></a>    time.sleep(<span class="fl">0.5</span>)  <span class="co"># Wait 500ms between requests</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Why rate limit?</strong></p>
<ul>
<li>Avoid getting blocked (HTTP 429: Too Many Requests)</li>
<li>Be a good API citizen</li>
<li>Most APIs specify limits in their documentation</li>
</ul>
</section>
<section id="post-requests-sending-data" class="slide level2">
<h2>POST Requests: Sending Data</h2>
<p>So far we’ve used <strong>GET</strong> to retrieve data. <strong>POST</strong> sends data to a server:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a></a><span class="co"># GET: retrieve data (parameters in URL)</span></span>
<span id="cb27-2"><a></a>response <span class="op">=</span> requests.get(url, params<span class="op">=</span>{<span class="st">"query"</span>: <span class="st">"python"</span>})</span>
<span id="cb27-3"><a></a></span>
<span id="cb27-4"><a></a><span class="co"># POST: send data (data in request body)</span></span>
<span id="cb27-5"><a></a>response <span class="op">=</span> requests.post(url, json<span class="op">=</span>{<span class="st">"name"</span>: <span class="st">"John"</span>, <span class="st">"email"</span>: <span class="st">"john@example.com"</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Common POST use cases:</strong></p>
<ul>
<li>Creating new records (users, posts, comments)</li>
<li>Submitting forms</li>
<li>Sending data for processing (e.g., ML model predictions)</li>
</ul>
<p><em>Note: Most data retrieval APIs use GET; POST is mainly for writing data.</em></p>
</section>
<section id="error-handling" class="slide level2">
<h2>Error Handling</h2>
<div id="error-handling-api" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a></a><span class="kw">def</span> safe_api_call(url, params<span class="op">=</span><span class="va">None</span>, timeout<span class="op">=</span><span class="dv">30</span>):</span>
<span id="cb28-2"><a></a>    <span class="co">"""Make an API call with proper error handling."""</span></span>
<span id="cb28-3"><a></a>    <span class="cf">try</span>:</span>
<span id="cb28-4"><a></a>        response <span class="op">=</span> requests.get(url, params<span class="op">=</span>params, timeout<span class="op">=</span>timeout)</span>
<span id="cb28-5"><a></a>        response.raise_for_status()  <span class="co"># Raises exception for 4xx/5xx</span></span>
<span id="cb28-6"><a></a>        <span class="cf">return</span> response.json()</span>
<span id="cb28-7"><a></a>    <span class="cf">except</span> requests.exceptions.Timeout:</span>
<span id="cb28-8"><a></a>        <span class="bu">print</span>(<span class="st">"Request timed out"</span>)</span>
<span id="cb28-9"><a></a>    <span class="cf">except</span> requests.exceptions.HTTPError <span class="im">as</span> e:</span>
<span id="cb28-10"><a></a>        <span class="bu">print</span>(<span class="ss">f"HTTP error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb28-11"><a></a>    <span class="cf">except</span> requests.exceptions.RequestException <span class="im">as</span> e:</span>
<span id="cb28-12"><a></a>        <span class="bu">print</span>(<span class="ss">f"Request failed: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb28-13"><a></a>    <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb28-14"><a></a></span>
<span id="cb28-15"><a></a><span class="co"># Example usage</span></span>
<span id="cb28-16"><a></a>data <span class="op">=</span> safe_api_call(<span class="st">"https://api.github.com/users/octocat"</span>)</span>
<span id="cb28-17"><a></a><span class="cf">if</span> data:</span>
<span id="cb28-18"><a></a>    <span class="bu">print</span>(<span class="ss">f"User: </span><span class="sc">{</span>data<span class="sc">.</span>get(<span class="st">'login'</span>)<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>User: octocat</code></pre>
</div>
</div>
</section>
<section id="error-handling-why-each-part-matters" class="slide level2">
<h2>Error Handling: Why Each Part Matters</h2>
<table class="caption-top">
<colgroup>
<col style="width: 26%">
<col style="width: 34%">
<col style="width: 39%">
</colgroup>
<thead>
<tr class="header">
<th>Component</th>
<th>What it does</th>
<th>Why it matters</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>try:</code></td>
<td>Wraps risky operations</td>
<td>APIs can fail for many reasons outside your control</td>
</tr>
<tr class="even">
<td><code>timeout=30</code></td>
<td>Limits wait time</td>
<td>Prevents your script from hanging indefinitely</td>
</tr>
<tr class="odd">
<td><code>raise_for_status()</code></td>
<td>Converts HTTP 4xx/5xx to exceptions</td>
<td>Without this, error responses look “successful”</td>
</tr>
<tr class="even">
<td><code>Timeout</code> exception</td>
<td>Catches slow/unresponsive servers</td>
<td>Network issues, server overload</td>
</tr>
<tr class="odd">
<td><code>HTTPError</code> exception</td>
<td>Catches bad responses (404, 500, etc.)</td>
<td>Invalid URLs, rate limiting (429), server errors</td>
</tr>
<tr class="even">
<td><code>RequestException</code></td>
<td>Catches everything else</td>
<td>DNS failures, connection refused, SSL errors</td>
</tr>
<tr class="odd">
<td><code>return None</code></td>
<td>Signals failure gracefully</td>
<td>Caller can check <code>if data:</code> instead of crashing</td>
</tr>
</tbody>
</table>
<p>Without error handling, a single failed API call would crash your entire script—especially problematic when looping through hundreds of requests.</p>
</section>
<section id="api-best-practices" class="slide level2 scrollable">
<h2>API Best Practices</h2>
<ol type="1">
<li><strong>Read the documentation</strong> - Every API is different</li>
<li><strong>Respect rate limits</strong> - Use <code>time.sleep()</code> between requests</li>
<li><strong>Handle errors gracefully</strong> - Check status codes</li>
<li><strong>Use timeouts</strong> - Don’t hang indefinitely</li>
<li><strong>Store tokens securely</strong> - Never commit API keys to git!</li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb30"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a></a><span class="co"># Use environment variables for tokens</span></span>
<span id="cb30-2"><a></a><span class="im">import</span> os</span>
<span id="cb30-3"><a></a>API_KEY <span class="op">=</span> os.environ.get(<span class="st">'TMDB_API_KEY'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="summary-apis" class="slide level2">
<h2>Summary: APIs</h2>
<ul>
<li>Use the <strong>requests</strong> library for HTTP calls</li>
<li>Pass <strong>parameters</strong> as dictionaries</li>
<li>Pass <strong>tokens</strong> in headers</li>
<li>Handle <strong>timeouts</strong> and <strong>errors</strong></li>
<li>Parse <strong>JSON</strong> responses with <code>.json()</code></li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a></a><span class="im">import</span> requests</span>
<span id="cb31-2"><a></a></span>
<span id="cb31-3"><a></a>response <span class="op">=</span> requests.get(url, params<span class="op">=</span>params, headers<span class="op">=</span>headers, timeout<span class="op">=</span><span class="dv">60</span>)</span>
<span id="cb31-4"><a></a>data <span class="op">=</span> response.json()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="fundamentals-of-web-scraping" class="slide level2">
<h2>Fundamentals of Web Scraping</h2>
<blockquote>
<p>Web scraping, web harvesting, or web data extraction is data scraping used for extracting data from websites – <a href="https://en.wikipedia.org/wiki/Web_scraping">Wikipedia</a></p>
</blockquote>
<p><strong>How in Python?</strong></p>
<ul>
<li><strong>requests</strong>: Fetch web pages</li>
<li><strong>pandas.read_html()</strong>: Extract tables directly</li>
<li><strong>BeautifulSoup</strong>: Parse and navigate HTML/XML documents</li>
<li><strong>selenium</strong>: For dynamic websites with JavaScript</li>
</ul>
</section>
<section id="scraping-data-from-a-webpage" class="slide level2">
<h2>Scraping Data from a Webpage</h2>
<p>Webpages contain data but are written in HTML, CSS, and JavaScript.</p>

<img data-src="img/wikipedia_scrape.png" class="quarto-figure quarto-figure-center r-stretch" style="width:150.0%"></section>
<section id="inspecting-html-with-browser-devtools" class="slide level2 scrollable">
<h2>Inspecting HTML with Browser DevTools</h2>
<p>To scrape a webpage, you need to understand its HTML structure:</p>
<ol type="1">
<li><strong>Right-click</strong> on the element you want → <strong>Inspect</strong></li>
<li>The <strong>Elements</strong> panel shows the HTML structure</li>
<li>Hover over elements to highlight them on the page</li>
<li>Look for patterns: tag names, classes, IDs</li>
</ol>
<p><strong>Common HTML elements to look for:</strong></p>
<table class="caption-top">
<thead>
<tr class="header">
<th>Element</th>
<th>Tag</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Tables</td>
<td><code>&lt;table&gt;</code></td>
<td>Data tables</td>
</tr>
<tr class="even">
<td>Links</td>
<td><code>&lt;a href="..."&gt;</code></td>
<td>Navigation, references</td>
</tr>
<tr class="odd">
<td>Paragraphs</td>
<td><code>&lt;p&gt;</code></td>
<td>Text content</td>
</tr>
<tr class="even">
<td>Divs</td>
<td><code>&lt;div class="..."&gt;</code></td>
<td>Content containers</td>
</tr>
<tr class="odd">
<td>Lists</td>
<td><code>&lt;ul&gt;</code>, <code>&lt;ol&gt;</code>, <code>&lt;li&gt;</code></td>
<td>Bulleted/numbered items</td>
</tr>
</tbody>
</table>
</section>
<section id="html-tables" class="slide level2">
<h2>HTML Tables</h2>
<p>HTML tables use these tags:</p>
<ul>
<li><code>&lt;table&gt;</code> - the container</li>
<li><code>&lt;tr&gt;</code> - table row</li>
<li><code>&lt;th&gt;</code> - header cell</li>
<li><code>&lt;td&gt;</code> - data cell</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb32"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb32-1"><a></a><span class="dt">&lt;</span><span class="kw">table</span><span class="dt">&gt;</span></span>
<span id="cb32-2"><a></a>  <span class="dt">&lt;</span><span class="kw">tr</span><span class="dt">&gt;&lt;</span><span class="kw">th</span><span class="dt">&gt;</span>Film<span class="dt">&lt;/</span><span class="kw">th</span><span class="dt">&gt;&lt;</span><span class="kw">th</span><span class="dt">&gt;</span>Year<span class="dt">&lt;/</span><span class="kw">th</span><span class="dt">&gt;&lt;</span><span class="kw">th</span><span class="dt">&gt;</span>Awards<span class="dt">&lt;/</span><span class="kw">th</span><span class="dt">&gt;&lt;/</span><span class="kw">tr</span><span class="dt">&gt;</span></span>
<span id="cb32-3"><a></a>  <span class="dt">&lt;</span><span class="kw">tr</span><span class="dt">&gt;&lt;</span><span class="kw">td</span><span class="dt">&gt;</span>Titanic<span class="dt">&lt;/</span><span class="kw">td</span><span class="dt">&gt;&lt;</span><span class="kw">td</span><span class="dt">&gt;</span>1997<span class="dt">&lt;/</span><span class="kw">td</span><span class="dt">&gt;&lt;</span><span class="kw">td</span><span class="dt">&gt;</span>11<span class="dt">&lt;/</span><span class="kw">td</span><span class="dt">&gt;&lt;/</span><span class="kw">tr</span><span class="dt">&gt;</span></span>
<span id="cb32-4"><a></a>  <span class="dt">&lt;</span><span class="kw">tr</span><span class="dt">&gt;&lt;</span><span class="kw">td</span><span class="dt">&gt;</span>Avatar<span class="dt">&lt;/</span><span class="kw">td</span><span class="dt">&gt;&lt;</span><span class="kw">td</span><span class="dt">&gt;</span>2009<span class="dt">&lt;/</span><span class="kw">td</span><span class="dt">&gt;&lt;</span><span class="kw">td</span><span class="dt">&gt;</span>3<span class="dt">&lt;/</span><span class="kw">td</span><span class="dt">&gt;&lt;/</span><span class="kw">tr</span><span class="dt">&gt;</span></span>
<span id="cb32-5"><a></a><span class="dt">&lt;/</span><span class="kw">table</span><span class="dt">&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="setup-for-scraping" class="slide level2">
<h2>Setup for Scraping</h2>
<div id="scraping-setup" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a></a><span class="im">import</span> requests</span>
<span id="cb33-2"><a></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb33-3"><a></a><span class="im">from</span> io <span class="im">import</span> StringIO</span>
<span id="cb33-4"><a></a><span class="im">import</span> re</span>
<span id="cb33-5"><a></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="making-requests-with-headers" class="slide level2">
<h2>Making Requests with Headers</h2>
<p>Always include a User-Agent header to identify yourself:</p>
<div id="scraping-headers" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a></a><span class="co"># URLs for our movie data</span></span>
<span id="cb34-2"><a></a>BOXOFFICE_URL <span class="op">=</span> <span class="st">"https://en.wikipedia.org/wiki/List_of_highest-grossing_films"</span></span>
<span id="cb34-3"><a></a>OSCARS_URL <span class="op">=</span> <span class="st">"https://en.wikipedia.org/wiki/List_of_Academy_Award</span><span class="sc">%E</span><span class="st">2</span><span class="sc">%80%</span><span class="st">93winning_films"</span></span>
<span id="cb34-4"><a></a></span>
<span id="cb34-5"><a></a><span class="co"># Headers to identify ourselves</span></span>
<span id="cb34-6"><a></a>HEADERS <span class="op">=</span> {</span>
<span id="cb34-7"><a></a>    <span class="st">"User-Agent"</span>: <span class="st">"jsc370-class-project/1.0 (educational use)"</span>,</span>
<span id="cb34-8"><a></a>    <span class="st">"Accept-Language"</span>: <span class="st">"en-US,en;q=0.9"</span>,</span>
<span id="cb34-9"><a></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="why-use-headers" class="slide level2">
<h2>Why Use Headers?</h2>
<p><strong>1. Servers may block requests without a User-Agent</strong></p>
<p>Without headers, <code>requests</code> sends a default like <code>python-requests/2.28.0</code>. Many websites block or rate-limit requests that look like bots.</p>
<p><strong>2. Identifying yourself is good etiquette</strong></p>
<p>If your script causes problems, site admins can contact you instead of blocking your IP.</p>
<p><strong>3. Accept-Language controls content language</strong></p>
<p>Wikipedia serves content in different languages based on this header.</p>
<table class="caption-top">
<colgroup>
<col style="width: 30%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th>Header</th>
<th>Purpose</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>User-Agent</code></td>
<td>Identifies the client</td>
<td><code>"MyApp/1.0 (contact@email.com)"</code></td>
</tr>
<tr class="even">
<td><code>Accept-Language</code></td>
<td>Preferred language</td>
<td><code>"en-US,en;q=0.9"</code></td>
</tr>
<tr class="odd">
<td><code>Accept</code></td>
<td>Expected response format</td>
<td><code>"application/json"</code></td>
</tr>
<tr class="even">
<td><code>Authorization</code></td>
<td>API tokens/credentials</td>
<td><code>"Bearer abc123"</code></td>
</tr>
</tbody>
</table>
</section>
<section id="fetching-the-data" class="slide level2">
<h2>Fetching the Data</h2>
<p>Use <code>requests.get</code> to grab the website data from the url</p>
<div id="scraping-fetch" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a></a><span class="co"># Request the box office page</span></span>
<span id="cb35-2"><a></a>boxoffice_request <span class="op">=</span> requests.get(BOXOFFICE_URL, headers<span class="op">=</span>HEADERS, timeout<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb35-3"><a></a></span>
<span id="cb35-4"><a></a><span class="cf">if</span> boxoffice_request.ok:</span>
<span id="cb35-5"><a></a>    <span class="bu">print</span>(<span class="st">"Box office response OK:"</span>, boxoffice_request.status_code)</span>
<span id="cb35-6"><a></a><span class="cf">else</span>:</span>
<span id="cb35-7"><a></a>    <span class="bu">print</span>(<span class="st">"Request failed:"</span>, boxoffice_request.status_code)</span>
<span id="cb35-8"><a></a></span>
<span id="cb35-9"><a></a><span class="co"># Request the Oscars page</span></span>
<span id="cb35-10"><a></a>oscars_request <span class="op">=</span> requests.get(OSCARS_URL, headers<span class="op">=</span>HEADERS, timeout<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb35-11"><a></a><span class="bu">print</span>(<span class="st">"Oscars response:"</span>, oscars_request.status_code)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Box office response OK: 200
Oscars response: 200</code></pre>
</div>
</div>
</section>
<section id="parsing-tables" class="slide level2">
<h2>Parsing Tables</h2>
<p>We want to turn HTML <code>&lt;table&gt;</code> tags into pandas DataFrames.</p>
<ul>
<li><code>pd.read_html()</code> scans HTML and returns a list of DataFrames—one per table found.</li>
<li><code>StringIO()</code> wraps the HTML string to look like a file-like object.</li>
</ul>
<div id="scraping-parse" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a></a><span class="co"># Parse all tables from each page</span></span>
<span id="cb37-2"><a></a>box_tables <span class="op">=</span> pd.read_html(StringIO(boxoffice_request.text))</span>
<span id="cb37-3"><a></a>osc_tables <span class="op">=</span> pd.read_html(StringIO(oscars_request.text))</span>
<span id="cb37-4"><a></a></span>
<span id="cb37-5"><a></a><span class="bu">print</span>(<span class="ss">f"Found </span><span class="sc">{</span><span class="bu">len</span>(box_tables)<span class="sc">}</span><span class="ss"> tables on box office page"</span>)</span>
<span id="cb37-6"><a></a><span class="bu">print</span>(<span class="ss">f"Found </span><span class="sc">{</span><span class="bu">len</span>(osc_tables)<span class="sc">}</span><span class="ss"> tables on Oscars page"</span>)</span>
<span id="cb37-7"><a></a></span>
<span id="cb37-8"><a></a><span class="co"># Get the main tables (first table on each page)</span></span>
<span id="cb37-9"><a></a>box <span class="op">=</span> box_tables[<span class="dv">0</span>]</span>
<span id="cb37-10"><a></a>osc <span class="op">=</span> osc_tables[<span class="dv">0</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Found 91 tables on box office page
Found 2 tables on Oscars page</code></pre>
</div>
</div>
<p>If the page has multiple tables, you might need to choose by inspecting <code>box_tables[i].columns</code> or by matching a column name.</p>
</section>
<section id="inspecting-the-data" class="slide level2">
<h2>Inspecting the Data</h2>
<p>Print out the data in <code>box</code> and <code>osc</code></p>
<div id="scraping-inspect" class="cell" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a></a><span class="bu">print</span>(<span class="st">"Box Office Data:"</span>)</span>
<span id="cb39-2"><a></a><span class="bu">print</span>(box.head(), <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb39-3"><a></a></span>
<span id="cb39-4"><a></a><span class="bu">print</span>(<span class="st">"Oscar Winners Data:"</span>)</span>
<span id="cb39-5"><a></a><span class="bu">print</span>(osc.head())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Box Office Data:
   Rank Peak                     Title   Worldwide gross  Year          Ref
0     1    1                    Avatar    $2,923,710,708  2009   [# 1][# 2]
1     2    1         Avengers: Endgame    $2,797,501,328  2019   [# 3][# 4]
2     3    3  Avatar: The Way of Water    $2,334,484,620  2022   [# 5][# 6]
3     4    1                   Titanic   T$2,257,906,828  1997   [# 7][# 8]
4     5    5                  Ne Zha 2  NZ$2,215,690,000  2025  [# 9][# 10] 

Oscar Winners Data:
             Film  Year Awards Nominations
0           Anora  2024      5           6
1   The Brutalist  2024      3          10
2    Emilia Pérez  2024      2          13
3          Wicked  2024      2          10
4  Dune: Part Two  2024      2           5</code></pre>
</div>
</div>
</section>
<section id="merging-dataframes" class="slide level2">
<h2>Merging DataFrames</h2>
<p>Combine data using <code>merge()</code>:</p>
<div id="scraping-merge-example" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a></a>osc[<span class="st">"Year"</span>] <span class="op">=</span> pd.to_numeric(osc[<span class="st">"Year"</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.extract(<span class="vs">r"</span><span class="kw">(</span><span class="dv">\d</span><span class="op">{4}</span><span class="kw">)</span><span class="vs">"</span>)[<span class="dv">0</span>], errors<span class="op">=</span><span class="st">"coerce"</span>)</span>
<span id="cb41-2"><a></a>osc[<span class="st">"Year"</span>] <span class="op">=</span> osc[<span class="st">"Year"</span>].astype(<span class="st">"Int64"</span>)</span>
<span id="cb41-3"><a></a></span>
<span id="cb41-4"><a></a><span class="co"># Left join: keep all box office films, add Oscar data where available</span></span>
<span id="cb41-5"><a></a>merged <span class="op">=</span> box.merge(</span>
<span id="cb41-6"><a></a>    osc,</span>
<span id="cb41-7"><a></a>    how<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb41-8"><a></a>    left_on<span class="op">=</span>[<span class="st">'Title'</span>, <span class="st">'Year'</span>],</span>
<span id="cb41-9"><a></a>    right_on<span class="op">=</span>[<span class="st">'Film'</span>, <span class="st">'Year'</span>]</span>
<span id="cb41-10"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>This requires a few steps due to messy scraped data. We will come back to this later</p>
</section>
<section id="scraping-beyond-tables-beautifulsoup" class="slide level2">
<h2>Scraping Beyond Tables: BeautifulSoup</h2>
<p>While <code>pd.read_html()</code> is great for tables, <strong>BeautifulSoup</strong> can extract any HTML element:</p>
<div id="bs4-beyond-tables" class="cell" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a></a><span class="co"># Parse the box office page with BeautifulSoup</span></span>
<span id="cb42-2"><a></a>soup <span class="op">=</span> BeautifulSoup(boxoffice_request.content, <span class="st">'html.parser'</span>)</span>
<span id="cb42-3"><a></a></span>
<span id="cb42-4"><a></a><span class="co"># Find the first paragraph</span></span>
<span id="cb42-5"><a></a>first_paragraph <span class="op">=</span> soup.find(<span class="st">'p'</span>)</span>
<span id="cb42-6"><a></a><span class="bu">print</span>(<span class="st">"First paragraph:"</span>, first_paragraph.get_text()[:<span class="dv">100</span>], <span class="st">"..."</span>)</span>
<span id="cb42-7"><a></a></span>
<span id="cb42-8"><a></a><span class="co"># Find all section headings</span></span>
<span id="cb42-9"><a></a>headings <span class="op">=</span> soup.find_all(<span class="st">'h2'</span>)</span>
<span id="cb42-10"><a></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Found </span><span class="sc">{</span><span class="bu">len</span>(headings)<span class="sc">}</span><span class="ss"> section headings"</span>)</span>
<span id="cb42-11"><a></a></span>
<span id="cb42-12"><a></a><span class="co"># Find the table of contents</span></span>
<span id="cb42-13"><a></a>toc <span class="op">=</span> soup.find(<span class="bu">id</span><span class="op">=</span><span class="st">'toc'</span>)</span>
<span id="cb42-14"><a></a><span class="bu">print</span>(<span class="ss">f"Table of contents found: </span><span class="sc">{</span>toc <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span><span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>First paragraph: 
 ...

Found 10 section headings
Table of contents found: False</code></pre>
</div>
</div>
</section>
<section id="beautifulsoup-extracting-links" class="slide level2">
<h2>BeautifulSoup: Extracting Links</h2>
<div id="bs4-links" class="cell" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a></a><span class="co"># Extract all citation/reference links from the films page</span></span>
<span id="cb44-2"><a></a>references <span class="op">=</span> []</span>
<span id="cb44-3"><a></a></span>
<span id="cb44-4"><a></a><span class="cf">for</span> link <span class="kw">in</span> soup.find_all(<span class="st">'a'</span>, href<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb44-5"><a></a>    href <span class="op">=</span> link[<span class="st">'href'</span>]</span>
<span id="cb44-6"><a></a>    text <span class="op">=</span> link.get_text().strip()</span>
<span id="cb44-7"><a></a>    <span class="co"># Find external reference links (not Wikipedia internal links)</span></span>
<span id="cb44-8"><a></a>    <span class="cf">if</span> href.startswith(<span class="st">'http'</span>) <span class="kw">and</span> <span class="st">'wikipedia'</span> <span class="kw">not</span> <span class="kw">in</span> href <span class="kw">and</span> text:</span>
<span id="cb44-9"><a></a>        references.append({</span>
<span id="cb44-10"><a></a>            <span class="st">'text'</span>: text[:<span class="dv">50</span>],  <span class="co"># Truncate long text</span></span>
<span id="cb44-11"><a></a>            <span class="st">'url'</span>: href[:<span class="dv">60</span>]    <span class="co"># Truncate long URLs</span></span>
<span id="cb44-12"><a></a>        })</span>
<span id="cb44-13"><a></a></span>
<span id="cb44-14"><a></a><span class="co"># Show first few external references</span></span>
<span id="cb44-15"><a></a>refs_df <span class="op">=</span> pd.DataFrame(references[:<span class="dv">8</span>])</span>
<span id="cb44-16"><a></a><span class="bu">print</span>(refs_df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                     text  \
0                           Wikidata item   
1  "Movies aren't the only B.O. monsters"   
2                                Archived   
3                  "Avatar – Video Sales"   
4                                Archived   
5                         "Unkind unwind"   
6                                Archived   
7                                     224   

                                                 url  
0  https://www.wikidata.org/wiki/Special:EntityPa...  
1  https://variety.com/2006/legit/news/movies-are...  
2  https://web.archive.org/web/20210420110457/htt...  
3  https://www.the-numbers.com/movie/Avatar#tab=v...  
4  https://web.archive.org/web/20181125204128/htt...  
5  https://www.economist.com/briefing/2011/03/17/...  
6  https://web.archive.org/web/20170904063950/htt...  
7  https://books.google.com/books?id=BfyFFCyRvX0C...  </code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p><strong>Key BeautifulSoup methods:</strong></p>
<ul>
<li><code>soup.find('tag')</code> - first matching element</li>
<li><code>soup.find_all('tag')</code> - all matching elements</li>
<li><code>element.get_text()</code> - extract text content</li>
<li><code>element['attribute']</code> - get attribute value (e.g., <code>href</code>)</li>
</ul>
</section>
<section id="regular-expressions-in-python" class="slide level2">
<h2>Regular Expressions in Python</h2>
<p><strong>Why regex?</strong> Scraped data is messy. Years appear as “2020/21”, currencies as “$2,923,710,708”, and text contains footnotes like “[1]”. Regex lets you extract and clean patterns programmatically.</p>
<p>The <code>re</code> module provides regex support:</p>
<div id="regex-intro" class="cell" data-execution_count="22">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a></a><span class="im">import</span> re</span>
<span id="cb46-2"><a></a></span>
<span id="cb46-3"><a></a>text <span class="op">=</span> <span class="st">"Contact us at support@example.com or sales@company.org"</span></span>
<span id="cb46-4"><a></a></span>
<span id="cb46-5"><a></a><span class="co"># Find all email addresses</span></span>
<span id="cb46-6"><a></a>pattern <span class="op">=</span> <span class="vs">r'</span><span class="pp">[</span><span class="dv">\w</span><span class="ch">\.</span><span class="pp">-]</span><span class="op">+</span><span class="vs">@</span><span class="pp">[</span><span class="dv">\w</span><span class="ch">\.</span><span class="pp">-]</span><span class="op">+</span><span class="vs">'</span></span>
<span id="cb46-7"><a></a>emails <span class="op">=</span> re.findall(pattern, text)</span>
<span id="cb46-8"><a></a><span class="bu">print</span>(<span class="ss">f"Found emails: </span><span class="sc">{</span>emails<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb46-9"><a></a></span>
<span id="cb46-10"><a></a><span class="co"># Replace pattern</span></span>
<span id="cb46-11"><a></a>new_text <span class="op">=</span> re.sub(pattern, <span class="st">"[EMAIL]"</span>, text)</span>
<span id="cb46-12"><a></a><span class="bu">print</span>(<span class="ss">f"Redacted: </span><span class="sc">{</span>new_text<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Found emails: ['support@example.com', 'sales@company.org']
Redacted: Contact us at [EMAIL] or [EMAIL]</code></pre>
</div>
</div>
</section>
<section id="breaking-down-the-email-pattern" class="slide level2">
<h2>Breaking Down the Email Pattern</h2>
<pre><code>r'[\w\.-]+@[\w\.-]+'</code></pre>
<table class="caption-top">
<colgroup>
<col style="width: 25%">
<col style="width: 37%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th>Part</th>
<th>Meaning</th>
<th>Matches</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>[\w\.-]</code></td>
<td>Character class: word chars, dots, hyphens</td>
<td><code>s</code>, <code>u</code>, <code>p</code>, <code>.</code>, <code>-</code></td>
</tr>
<tr class="even">
<td><code>+</code></td>
<td>One or more of the previous</td>
<td><code>support</code>, <code>example.com</code></td>
</tr>
<tr class="odd">
<td><code>@</code></td>
<td>Literal @ symbol</td>
<td><code>@</code></td>
</tr>
<tr class="even">
<td><code>[\w\.-]+</code></td>
<td>Same pattern after @</td>
<td><code>example.com</code></td>
</tr>
</tbody>
</table>
<p><strong>Key <code>re</code> functions:</strong></p>
<table class="caption-top">
<colgroup>
<col style="width: 35%">
<col style="width: 32%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Purpose</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>re.findall(pattern, text)</code></td>
<td>Find all matches</td>
<td>Returns list of matches</td>
</tr>
<tr class="even">
<td><code>re.search(pattern, text)</code></td>
<td>Find first match</td>
<td>Returns match object or None</td>
</tr>
<tr class="odd">
<td><code>re.sub(pattern, repl, text)</code></td>
<td>Replace matches</td>
<td>Returns modified string</td>
</tr>
</tbody>
</table>
</section>
<section id="common-regex-patterns" class="slide level2">
<h2>Common Regex Patterns</h2>
<table class="caption-top">
<thead>
<tr class="header">
<th>Pattern</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>\d</code></td>
<td>Digit (0-9)</td>
</tr>
<tr class="even">
<td><code>\w</code></td>
<td>Word character (a-z, A-Z, 0-9, _)</td>
</tr>
<tr class="odd">
<td><code>\s</code></td>
<td>Whitespace</td>
</tr>
<tr class="even">
<td><code>.</code></td>
<td>Any character</td>
</tr>
<tr class="odd">
<td><code>*</code></td>
<td>Zero or more</td>
</tr>
<tr class="even">
<td><code>+</code></td>
<td>One or more</td>
</tr>
<tr class="odd">
<td><code>?</code></td>
<td>Zero or one</td>
</tr>
<tr class="even">
<td><code>[]</code></td>
<td>Character class</td>
</tr>
<tr class="odd">
<td><code>^</code></td>
<td>Start of string</td>
</tr>
<tr class="even">
<td><code>$</code></td>
<td>End of string</td>
</tr>
</tbody>
</table>
</section>
<section id="cleaning-data-with-regular-expressions" class="slide level2">
<h2>Cleaning Data with Regular Expressions</h2>
<p>Some values need cleaning (e.g., “2020/21” should be “2020”):</p>
<div id="scraping-regex-clean" class="cell" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a></a><span class="co"># Extract just the first 4-digit year</span></span>
<span id="cb49-2"><a></a>year_example <span class="op">=</span> <span class="st">"2020/21"</span></span>
<span id="cb49-3"><a></a>clean_year <span class="op">=</span> re.search(<span class="vs">r'</span><span class="dv">\d</span><span class="op">{4}</span><span class="vs">'</span>, year_example).group()</span>
<span id="cb49-4"><a></a><span class="bu">print</span>(<span class="ss">f"'</span><span class="sc">{</span>year_example<span class="sc">}</span><span class="ss">' -&gt; '</span><span class="sc">{</span>clean_year<span class="sc">}</span><span class="ss">'"</span>)</span>
<span id="cb49-5"><a></a></span>
<span id="cb49-6"><a></a><span class="co"># Clean currency: "$2,923,710,708" -&gt; 2923710708</span></span>
<span id="cb49-7"><a></a>gross_example <span class="op">=</span> <span class="st">"$2,923,710,708"</span></span>
<span id="cb49-8"><a></a>clean_gross <span class="op">=</span> re.sub(<span class="vs">r'</span><span class="pp">[^</span><span class="dv">\d</span><span class="pp">]</span><span class="vs">'</span>, <span class="st">''</span>, gross_example)</span>
<span id="cb49-9"><a></a><span class="bu">print</span>(<span class="ss">f"'</span><span class="sc">{</span>gross_example<span class="sc">}</span><span class="ss">' -&gt; </span><span class="sc">{</span><span class="bu">int</span>(clean_gross)<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>'2020/21' -&gt; '2020'
'$2,923,710,708' -&gt; 2923710708</code></pre>
</div>
</div>
</section>
<section id="understanding-the-cleaning-patterns" class="slide level2">
<h2>Understanding the Cleaning Patterns</h2>
<p><strong>Pattern 1: Extract year</strong> <code>r'\d{4}'</code></p>
<table class="caption-top">
<thead>
<tr class="header">
<th>Part</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>\d</code></td>
<td>Any digit (0-9)</td>
</tr>
<tr class="even">
<td><code>{4}</code></td>
<td>Exactly 4 of them</td>
</tr>
</tbody>
</table>
<p>Matches: <code>"2020"</code> from <code>"2020/21"</code> — ignores the <code>/21</code> part</p>
<p><strong>Pattern 2: Remove non-digits</strong> <code>r'[^\d]'</code></p>
<table class="caption-top">
<thead>
<tr class="header">
<th>Part</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>[^...]</code></td>
<td>NOT these characters (negation)</td>
</tr>
<tr class="even">
<td><code>\d</code></td>
<td>Digits</td>
</tr>
<tr class="odd">
<td>Together</td>
<td>Match anything that is NOT a digit</td>
</tr>
</tbody>
</table>
<p><code>re.sub(r'[^\d]', '', text)</code> replaces all non-digits with nothing, leaving only numbers.</p>
<p><code>"$2,923,710,708"</code> → <code>"2923710708"</code></p>
</section>
<section id="cleaning-the-year-column" class="slide level2">
<h2>Cleaning the Year Column</h2>
<div id="scraping-clean-year" class="cell" data-execution_count="24">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a></a><span class="co"># Extract 4-digit year and convert to int</span></span>
<span id="cb51-2"><a></a>osc[<span class="st">'Year_clean'</span>] <span class="op">=</span> (osc[<span class="st">'Year'</span>]</span>
<span id="cb51-3"><a></a>    .astype(<span class="bu">str</span>)</span>
<span id="cb51-4"><a></a>    .<span class="bu">str</span>.extract(<span class="vs">r'</span><span class="kw">(</span><span class="dv">\d</span><span class="op">{4}</span><span class="kw">)</span><span class="vs">'</span>, expand<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb51-5"><a></a>    .astype(<span class="st">'int'</span>, errors<span class="op">=</span><span class="st">'ignore'</span>))</span>
<span id="cb51-6"><a></a></span>
<span id="cb51-7"><a></a><span class="bu">print</span>(osc[[<span class="st">'Year'</span>, <span class="st">'Year_clean'</span>]].head(<span class="dv">10</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Year  Year_clean
0  2024        2024
1  2024        2024
2  2024        2024
3  2024        2024
4  2024        2024
5  2024        2024
6  2024        2024
7  2024        2024
8  2024        2024
9  2024        2024</code></pre>
</div>
</div>
</section>
<section id="merging-box-office-and-oscar-data" class="slide level2">
<h2>Merging Box Office and Oscar Data</h2>
<div id="cell-scraping-merge-real" class="cell" data-execution_count="25">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a></a><span class="co"># Clean the year column first</span></span>
<span id="cb53-2"><a></a>osc[<span class="st">'Year'</span>] <span class="op">=</span> pd.to_numeric(</span>
<span id="cb53-3"><a></a>    osc[<span class="st">'Year'</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.extract(<span class="vs">r'</span><span class="kw">(</span><span class="dv">\d</span><span class="op">{4}</span><span class="kw">)</span><span class="vs">'</span>, expand<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb53-4"><a></a>    errors<span class="op">=</span><span class="st">'coerce'</span></span>
<span id="cb53-5"><a></a>)</span>
<span id="cb53-6"><a></a></span>
<span id="cb53-7"><a></a><span class="co"># Merge the dataframes</span></span>
<span id="cb53-8"><a></a>merged <span class="op">=</span> box.merge(</span>
<span id="cb53-9"><a></a>    osc,</span>
<span id="cb53-10"><a></a>    how<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb53-11"><a></a>    left_on<span class="op">=</span>[<span class="st">'Title'</span>, <span class="st">'Year'</span>],</span>
<span id="cb53-12"><a></a>    right_on<span class="op">=</span>[<span class="st">'Film'</span>, <span class="st">'Year'</span>]</span>
<span id="cb53-13"><a></a>)</span>
<span id="cb53-14"><a></a></span>
<span id="cb53-15"><a></a><span class="bu">print</span>(<span class="ss">f"Merged shape: </span><span class="sc">{</span>merged<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb53-16"><a></a>merged[[<span class="st">'Title'</span>, <span class="st">'Year'</span>, <span class="st">'Worldwide gross'</span>, <span class="st">'Awards'</span>]].head(<span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Merged shape: (50, 10)</code></pre>
</div>
<div id="scraping-merge-real" class="cell-output cell-output-display" data-execution_count="23">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Title</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Worldwide gross</th>
<th data-quarto-table-cell-role="th">Awards</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>Avatar</td>
<td>2009</td>
<td>$2,923,710,708</td>
<td>3</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>Avengers: Endgame</td>
<td>2019</td>
<td>$2,797,501,328</td>
<td>NaN</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>Avatar: The Way of Water</td>
<td>2022</td>
<td>$2,334,484,620</td>
<td>1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>Titanic</td>
<td>1997</td>
<td>T$2,257,906,828</td>
<td>11</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>Ne Zha 2</td>
<td>2025</td>
<td>NZ$2,215,690,000</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>Star Wars: The Force Awakens</td>
<td>2015</td>
<td>$2,068,223,624</td>
<td>NaN</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>Avengers: Infinity War</td>
<td>2018</td>
<td>$2,048,359,754</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>Spider-Man: No Way Home</td>
<td>2021</td>
<td>SM$1,922,598,800</td>
<td>NaN</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>Zootopia 2 †</td>
<td>2025</td>
<td>$1,776,957,359</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>Inside Out 2</td>
<td>2024</td>
<td>$1,698,863,816</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="cleaning-worldwide-gross" class="slide level2">
<h2>Cleaning Worldwide Gross</h2>
<div id="cell-scraping-clean-gross" class="cell" data-execution_count="26">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a></a><span class="co"># Extract numbers from gross column using regex</span></span>
<span id="cb55-2"><a></a><span class="co"># Pattern matches: 1,234,567 or just 1234567</span></span>
<span id="cb55-3"><a></a>gross_clean <span class="op">=</span> (merged[<span class="st">'Worldwide gross'</span>]</span>
<span id="cb55-4"><a></a>    .astype(<span class="bu">str</span>)</span>
<span id="cb55-5"><a></a>    .<span class="bu">str</span>.extract(<span class="vs">r'</span><span class="kw">(</span><span class="dv">\d</span><span class="op">{1,3}</span>(?:<span class="vs">,</span><span class="dv">\d</span><span class="op">{3}</span>)<span class="op">+</span><span class="cf">|</span><span class="dv">\d</span><span class="op">{4,}</span><span class="kw">)</span><span class="vs">'</span>, expand<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb55-6"><a></a>    .<span class="bu">str</span>.replace(<span class="st">','</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb55-7"><a></a>    .astype(<span class="st">'Int64'</span>))</span>
<span id="cb55-8"><a></a></span>
<span id="cb55-9"><a></a>merged[<span class="st">'gross_clean'</span>] <span class="op">=</span> gross_clean</span>
<span id="cb55-10"><a></a>merged[[<span class="st">'Title'</span>, <span class="st">'Worldwide gross'</span>, <span class="st">'gross_clean'</span>]].head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="scraping-clean-gross" class="cell-output cell-output-display" data-execution_count="24">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Title</th>
<th data-quarto-table-cell-role="th">Worldwide gross</th>
<th data-quarto-table-cell-role="th">gross_clean</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>Avatar</td>
<td>$2,923,710,708</td>
<td>2923710708</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>Avengers: Endgame</td>
<td>$2,797,501,328</td>
<td>2797501328</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>Avatar: The Way of Water</td>
<td>$2,334,484,620</td>
<td>2334484620</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>Titanic</td>
<td>T$2,257,906,828</td>
<td>2257906828</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>Ne Zha 2</td>
<td>NZ$2,215,690,000</td>
<td>2215690000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="handling-missing-values" class="slide level2">
<h2>Handling Missing Values</h2>
<div id="scraping-fillna" class="cell" data-execution_count="27">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a></a><span class="co"># Fill missing Awards with 0 (no Oscar wins)</span></span>
<span id="cb56-2"><a></a>merged[<span class="st">'Awards'</span>] <span class="op">=</span> merged[<span class="st">'Awards'</span>].fillna(<span class="dv">0</span>).astype(<span class="st">'int'</span>)</span>
<span id="cb56-3"><a></a></span>
<span id="cb56-4"><a></a><span class="co"># Create indicator for Oscar winners</span></span>
<span id="cb56-5"><a></a>merged[<span class="st">'won_oscar'</span>] <span class="op">=</span> merged[<span class="st">'Awards'</span>] <span class="op">&gt;=</span> <span class="dv">1</span></span>
<span id="cb56-6"><a></a></span>
<span id="cb56-7"><a></a><span class="bu">print</span>(merged[[<span class="st">'Title'</span>, <span class="st">'Awards'</span>, <span class="st">'won_oscar'</span>]].head(<span class="dv">10</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                          Title  Awards  won_oscar
0                        Avatar       3       True
1             Avengers: Endgame       0      False
2      Avatar: The Way of Water       1       True
3                       Titanic      11       True
4                      Ne Zha 2       0      False
5  Star Wars: The Force Awakens       0      False
6        Avengers: Infinity War       0      False
7       Spider-Man: No Way Home       0      False
8                  Zootopia 2 †       0      False
9                  Inside Out 2       0      False</code></pre>
</div>
</div>
</section>
<section id="comparing-oscar-winners-vs-non-winners" class="slide level2">
<h2>Comparing Oscar Winners vs Non-Winners</h2>
<div id="scraping-groupby" class="cell" data-execution_count="28">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a></a><span class="co"># Group by Oscar status and compute statistics</span></span>
<span id="cb58-2"><a></a>summary <span class="op">=</span> (merged</span>
<span id="cb58-3"><a></a>    .groupby(<span class="st">'won_oscar'</span>)[<span class="st">'gross_clean'</span>]</span>
<span id="cb58-4"><a></a>    .agg(num_movies<span class="op">=</span><span class="st">'count'</span>, avg_gross<span class="op">=</span><span class="st">'mean'</span>, median_gross<span class="op">=</span><span class="st">'median'</span>))</span>
<span id="cb58-5"><a></a></span>
<span id="cb58-6"><a></a><span class="bu">print</span>(summary)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>           num_movies          avg_gross  median_gross
won_oscar                                             
False              37  1409851897.621622  1308476166.0
True               13  1510293283.384615  1290000000.0</code></pre>
</div>
</div>
</section>
<section id="visualizing-the-results" class="slide level2">
<h2>Visualizing the Results</h2>
<div id="cell-scraping-viz" class="cell" data-fig-height="5" data-fig-width="10" data-execution_count="29">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb60-2"><a></a></span>
<span id="cb60-3"><a></a>no_wins <span class="op">=</span> merged[merged[<span class="st">'won_oscar'</span>] <span class="op">==</span> <span class="va">False</span>][<span class="st">'gross_clean'</span>].dropna()</span>
<span id="cb60-4"><a></a>winners <span class="op">=</span> merged[merged[<span class="st">'won_oscar'</span>] <span class="op">==</span> <span class="va">True</span>][<span class="st">'gross_clean'</span>].dropna()</span>
<span id="cb60-5"><a></a></span>
<span id="cb60-6"><a></a>plt.boxplot([no_wins, winners], tick_labels<span class="op">=</span>[<span class="st">"No Oscar"</span>, <span class="st">"Oscar Winner"</span>])</span>
<span id="cb60-7"><a></a>plt.ylabel(<span class="st">"Worldwide Gross (USD)"</span>)</span>
<span id="cb60-8"><a></a>plt.title(<span class="st">"Box Office Revenue: Oscar Winners vs Non-Winners"</span>)</span>
<span id="cb60-9"><a></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="JSC370-slides-05_files/figure-revealjs/scraping-viz-output-1.png" id="scraping-viz" width="821" height="431"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="summary-web-scraping" class="slide level2">
<h2>Summary: Web Scraping</h2>
<ul>
<li>Use <strong>BeautifulSoup</strong> to parse HTML</li>
<li>Use <strong>pandas.read_html()</strong> for tables</li>
<li>Clean data with <strong>regular expressions</strong></li>
<li>Be respectful - check <code>robots.txt</code></li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb61"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb61-2"><a></a><span class="im">import</span> requests</span>
<span id="cb61-3"><a></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb61-4"><a></a></span>
<span id="cb61-5"><a></a>response <span class="op">=</span> requests.get(url)</span>
<span id="cb61-6"><a></a>soup <span class="op">=</span> BeautifulSoup(response.content, <span class="st">'html.parser'</span>)</span>
<span id="cb61-7"><a></a>tables <span class="op">=</span> pd.read_html(<span class="bu">str</span>(soup))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="resources" class="slide level2">
<h2>Resources</h2>
<ul>
<li><a href="https://docs.python-requests.org/">Requests Documentation</a></li>
<li><a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/">BeautifulSoup Documentation</a></li>
<li><a href="https://docs.python.org/3/howto/regex.html">Python Regex HOWTO</a></li>
<li><a href="https://httpstatuses.com/">HTTP Status Codes</a></li>
<li><a href="https://github.com/public-apis/public-apis">Public APIs List</a></li>
</ul>
</section>
<section class="slide level2">



</section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>